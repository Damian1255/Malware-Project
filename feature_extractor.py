import os
import pandas as pd
import imports.extractor as extractor

def main(root_folder_name='malwares', output_file='datasets/malware_features.csv'):
    features_dict = {}
    
    # Check if the root folder exists
    try:
        folders = os.listdir(root_folder_name)
    except FileNotFoundError:
        print('Root folder not found. Please check the path and try again.')
        return

    # Iterate through the folders in the root folder and extract features for each item
    for folder in folders:
        folder_path = os.path.join(root_folder_name, folder)
        
        # Skip if the item is not a folder
        if not os.path.isdir(folder_path):
            continue
        
        # Get the items in the folder
        items = os.listdir(folder_path)

        # Skip if the folder is empty
        if not items:
            continue
        
        # Extract features for each item in the folder
        for item in items:
            item_url = os.path.join(folder_path, item)
            features = extractor.extract_features(item_url)
            
            if features is not None:
                features_dict[item] = features
                print('[SUCCESS]', item_url)
            else:
                print('[FAILED]', item_url)

    # Convert the dictionary to a DataFrame and save to a CSV file
    print('Extraction Completed. Saving to CSV file...')
    df = pd.DataFrame.from_dict(features_dict, orient='index')
    df.to_csv(output_file, index=False)


if __name__ == '__main__':
    main()