import pefile
import pandas as pd

def extract_features(path):
    features_dict = {}
    try:
        sample = pefile.PE(path)
    except Exception as e:
        return None    

    # Add features to the dictionary
    features_dict['Name'] = path.split('/')[-1]
    features_dict['MD5'] = sample.OPTIONAL_HEADER.CheckSum
    features_dict['Machine'] = sample.FILE_HEADER.Machine
    features_dict['SizeOfOptionalHeader'] = sample.FILE_HEADER.SizeOfOptionalHeader
    features_dict['Characteristics'] = sample.FILE_HEADER.Characteristics
    features_dict['MajorLinkerVersion'] = sample.OPTIONAL_HEADER.MajorLinkerVersion
    features_dict['MinorLinkerVersion'] = sample.OPTIONAL_HEADER.MinorLinkerVersion
    features_dict['SizeOfCode'] = sample.OPTIONAL_HEADER.SizeOfCode
    features_dict['SizeOfInitializedData'] = sample.OPTIONAL_HEADER.SizeOfInitializedData
    features_dict['SizeOfUninitializedData'] = sample.OPTIONAL_HEADER.SizeOfUninitializedData
    features_dict['AddressOfEntryPoint'] = sample.OPTIONAL_HEADER.AddressOfEntryPoint
    features_dict['BaseOfCode'] = sample.OPTIONAL_HEADER.BaseOfCode
    features_dict['BaseOfData'] = sample.OPTIONAL_HEADER.BaseOfData
    features_dict['ImageBase'] = sample.OPTIONAL_HEADER.ImageBase
    features_dict['SectionAlignment'] = sample.OPTIONAL_HEADER.SectionAlignment
    features_dict['FileAlignment'] = sample.OPTIONAL_HEADER.FileAlignment
    features_dict['MajorOperatingSystemVersion'] = sample.OPTIONAL_HEADER.MajorOperatingSystemVersion
    features_dict['MinorOperatingSystemVersion'] = sample.OPTIONAL_HEADER.MinorOperatingSystemVersion
    features_dict['MajorImageVersion'] = sample.OPTIONAL_HEADER.MajorImageVersion
    features_dict['MinorImageVersion'] = sample.OPTIONAL_HEADER.MinorImageVersion
    features_dict['MajorSubsystemVersion'] = sample.OPTIONAL_HEADER.MajorSubsystemVersion
    features_dict['MinorSubsystemVersion'] = sample.OPTIONAL_HEADER.MinorSubsystemVersion
    features_dict['SizeOfImage'] = sample.OPTIONAL_HEADER.SizeOfImage
    features_dict['SizeOfHeaders'] = sample.OPTIONAL_HEADER.SizeOfHeaders
    features_dict['CheckSum'] = sample.OPTIONAL_HEADER.CheckSum
    features_dict['Subsystem'] = sample.OPTIONAL_HEADER.Subsystem
    features_dict['DllCharacteristics'] = sample.OPTIONAL_HEADER.DllCharacteristics
    features_dict['SizeOfStackReserve'] = sample.OPTIONAL_HEADER.SizeOfStackReserve
    features_dict['SizeOfStackCommit'] = sample.OPTIONAL_HEADER.SizeOfStackCommit
    features_dict['SizeOfHeapReserve'] = sample.OPTIONAL_HEADER.SizeOfHeapReserve
    features_dict['SizeOfHeapCommit'] = sample.OPTIONAL_HEADER.SizeOfHeapCommit
    features_dict['LoaderFlags'] = sample.OPTIONAL_HEADER.LoaderFlags
    features_dict['NumberOfRvaAndSizes'] = sample.OPTIONAL_HEADER.NumberOfRvaAndSizes
    features_dict['SectionsNb'] = sample.FILE_HEADER.NumberOfSections
    # features_dict['SectionsMeanEntropy'] = sample.SECTIONS_MEAN_ENTROPY
    # features_dict['SectionsMinEntropy'] = sample.SECTIONS_MIN_ENTROPY
    # features_dict['SectionsMaxEntropy'] = sample.SECTIONS_MAX_ENTROPY
    # features_dict['SectionsMeanRawsize'] = sample.SECTIONS_MEAN_RAWSIZE
    # features_dict['SectionsMinRawsize'] = sample.SECTIONS_MIN_RAWSIZE
    # features_dict['SectionMaxRawsize'] = sample.SECTION_MAX_RAWSIZE
    # features_dict['SectionsMeanVirtualsize'] = sample.SECTIONS_MEAN_VIRTUALSIZE
    # features_dict['SectionsMinVirtualsize'] = sample.SECTIONS_MIN_VIRTUALSIZE
    # features_dict['SectionMaxVirtualsize'] = sample.SECTION_MAX_VIRTUALSIZE
    # features_dict['ImportsNbDLL'] = sample.IMPORTS_NB_DLL
    # features_dict['ImportsNb'] = sample.IMPORTS_NB
    # features_dict['ImportsNbOrdinal'] = sample.IMPORTS_NB_ORDINAL
    # features_dict['ExportNb'] = sample.EXPORT_NB
    # features_dict['ResourcesNb'] = sample.RESOURCES_NB
    # features_dict['ResourcesMeanEntropy'] = sample.RESOURCES_MEAN_ENTROPY
    # features_dict['ResourcesMinEntropy'] = sample.RESOURCES_MIN_ENTROPY
    # features_dict['ResourcesMaxEntropy'] = sample.RESOURCES_MAX_ENTROPY
    # features_dict['ResourcesMeanSize'] = sample.RESOURCES_MEAN_SIZE
    # features_dict['ResourcesMinSize'] = sample.RESOURCES_MIN_SIZE
    # features_dict['ResourcesMaxSize'] = sample.RESOURCES_MAX_SIZE
    # features_dict['LoadConfigurationSize'] = sample.LOAD_CONFIGURATION_SIZE
    # features_dict['VersionInformationSize'] = sample.VERSION_INFORMATION_SIZE

    return features_dict