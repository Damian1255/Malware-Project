import os
import sys
import json
import pandas as pd
import imports.pybinlex as binlex

root_folder_name = 'org/Agentc'
traits_dict = {}
counter = 0

# Check if the specified root folder exists
files = os.listdir(root_folder_name)[0:5]
item_count = len(files)

# Iterate through the files in the root folder
for file in files:
    file_path = os.path.join(root_folder_name, file)

    # Extract traits from a file
    pe = binlex.PE()
    result = pe.read_file(file_path)

    # Check if the file was read successfully
    if result is False: sys.exit(1)

    # Disassemble the file
    disassembler = binlex.Disassembler(pe)
    disassembler.disassemble()

    # Get the traits of the file
    traits = disassembler.get_traits()

    # Add the traits to the dictionary
    traits_dict[file] = json.dumps(traits)
    counter += 1

    print(f'Extracted traits from {file} ({counter}/{item_count})')

# convert the dictionary to a DataFrame 
df = pd.DataFrame.from_dict(traits_dict, orient='index')
print(df)
