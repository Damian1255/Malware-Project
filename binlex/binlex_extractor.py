import os
import sys
import pybinlex
import pandas as pd

root_folder_name = 'org/Adnur'
traits_df = pd.DataFrame()
counter = 0

# Check if the specified root folder exists
files = os.listdir(root_folder_name)
item_count = len(files)

# Iterate through the files in the root folder
for file in files:
    file_path = os.path.join(root_folder_name, file)

    try:
        # Extract traits from a file
        pe = pybinlex.PE()
        result = pe.read_file(file_path)

        # Disassemble the file
        disassembler = pybinlex.Disassembler(pe)
        disassembler.disassemble()

        # Get the traits of the file
        traits = disassembler.get_traits()
        except Exception as e:
        print(f'Error: {e}')
        continue

    # convert the traits to a pandas DataFrame and concatenate it to the main DataFrame
    df = pd.DataFrame(traits)
    traits_df = pd.concat([traits_df, df], ignore_index=True)
    counter += 1

    print(f'Extracted traits from {file} ({counter}/{item_count})')

# save the data to csv
traits_df.to_csv('binlex/traits.csv', index=False)
