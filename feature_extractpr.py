import os
import pandas as pd
import extractor

# open malware folder
root_folder_name = 'malwares'

# main function
def main():
    features_dict = {}
    folders = os.listdir(root_folder_name)

    # loop through each folder and list the files
    for folder in folders:
        folder_path = root_folder_name + '/' + folder
        items = os.listdir(folder_path)

        # check if content is not empty
        if not items:
            continue

        # loop through each file and extract features
        for item in items:
            item_url = folder_path + '/' + item
            features = extractor.extract_features(item_url)
            
            # check if features is not None and add to the dictionary
            if features is not None:
                features_dict[item] = features
                print('Extracted features for: ', item_url)
            else:
                print('Error extracting features for: ', item_url)
                continue

    # convert the dictionary to a dataframe
    df = pd.DataFrame.from_dict(features_dict, orient='index')
    df.to_csv('malware_features.csv')


if __name__ == '__main__':
    main()